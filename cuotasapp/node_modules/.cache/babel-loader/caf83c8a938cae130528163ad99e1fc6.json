{"ast":null,"code":"var requestManager = require('../request-manager');\n\nvar preapprovalModule = require('./preapproval');\n\nvar merchantOrdersModule = require('./merchantOrders');\n\nvar MercadopagoIpnResponse = require('../utils/mercadopagoIpnResponse');\n\nvar Promise = require('bluebird');\n\nvar preConditions = require('../precondition');\n\nvar ipn = module.exports = {\n  available_topics: ['preapproval', 'authorized_payment', 'payment', 'merchant_order']\n};\nipn.getPayment = requestManager.describe({\n  path: '/v1/payments/:id',\n  method: 'GET'\n});\nipn.getAuthorizedPayment = requestManager.describe({\n  path: '/authorized_payments/:id',\n  method: 'GET'\n});\n/**\n * Manage the request obtain by the ipn endpoint\n * @param request\n * @param callback\n * @returns {*}\n */\n\nipn.manage = function (request, callback) {\n  callback = preConditions.getCallback(callback);\n  return new Promise(function (resolve, reject) {\n    var id = request.query.id;\n    var topic = request.query.topic;\n    var mpResponse;\n    var mpError;\n\n    if (this.available_topics.indexOf(topic) !== -1) {\n      this[topic](id, function (err, response) {\n        if (err) {\n          reject(err);\n          return callback.apply(null, [err, null]);\n        }\n\n        mpResponse = new MercadopagoIpnResponse(id, topic, response.status, response.body);\n        resolve(mpResponse);\n        return callback.apply(null, [null, mpResponse]);\n      });\n    } else {\n      mpError = new Error('Invalid Topic (' + topic + '). The topics available are: ' + this.available_topics.join(', '));\n      reject(mpError);\n      return callback.apply(null, [mpError, null]);\n    }\n  }.bind(this));\n};\n\nipn.payment = function (id, callback) {\n  return this.getPayment(id, callback);\n};\n\nipn.authorized_payment = function (id, callback) {\n  return this.getAuthorizedPayment(id, callback);\n};\n\nipn.preapproval = function (id, callback) {\n  return preapprovalModule.get(id, callback);\n};\n\nipn.merchant_order = function (id, callback) {\n  return merchantOrdersModule.get(id, callback);\n};","map":{"version":3,"sources":["C:/Users/juanm/Documents/Proyecto_web/ProyectoFinal-IAW/cuotasapp/node_modules/mercadopago/lib/resources/ipn.js"],"names":["requestManager","require","preapprovalModule","merchantOrdersModule","MercadopagoIpnResponse","Promise","preConditions","ipn","module","exports","available_topics","getPayment","describe","path","method","getAuthorizedPayment","manage","request","callback","getCallback","resolve","reject","id","query","topic","mpResponse","mpError","indexOf","err","response","apply","status","body","Error","join","bind","payment","authorized_payment","preapproval","get","merchant_order"],"mappings":"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","sourcesContent":["var requestManager = require('../request-manager');\nvar preapprovalModule = require('./preapproval');\nvar merchantOrdersModule = require('./merchantOrders');\nvar MercadopagoIpnResponse = require('../utils/mercadopagoIpnResponse');\nvar Promise = require('bluebird');\nvar preConditions = require('../precondition');\n\nvar ipn = module.exports = {\n  available_topics: ['preapproval', 'authorized_payment', 'payment', 'merchant_order']\n};\n\nipn.getPayment = requestManager.describe({\n  path: '/v1/payments/:id',\n  method: 'GET'\n});\n\nipn.getAuthorizedPayment = requestManager.describe({\n  path: '/authorized_payments/:id',\n  method: 'GET'\n});\n\n/**\n * Manage the request obtain by the ipn endpoint\n * @param request\n * @param callback\n * @returns {*}\n */\nipn.manage = function (request, callback) {\n  callback = preConditions.getCallback(callback);\n\n  return new Promise(function (resolve, reject) {\n    var id = request.query.id;\n    var topic = request.query.topic;\n    var mpResponse;\n    var mpError;\n\n    if (this.available_topics.indexOf(topic) !== -1) {\n      this[topic](id, function (err, response) {\n        if (err) {\n          reject(err);\n          return callback.apply(null, [err, null]);\n        }\n\n        mpResponse = new MercadopagoIpnResponse(id, topic, response.status, response.body);\n        resolve(mpResponse);\n        return callback.apply(null, [null, mpResponse]);\n      });\n    } else {\n      mpError = new Error('Invalid Topic (' + topic + '). The topics available are: '\n        + this.available_topics.join(', '));\n      reject(mpError);\n      return callback.apply(null, [mpError, null]);\n    }\n  }.bind(this));\n};\n\nipn.payment = function (id, callback) {\n  return this.getPayment(id, callback);\n};\n\nipn.authorized_payment = function (id, callback) {\n  return this.getAuthorizedPayment(id, callback);\n};\n\nipn.preapproval = function (id, callback) {\n  return preapprovalModule.get(id, callback);\n};\n\nipn.merchant_order = function (id, callback) {\n  return merchantOrdersModule.get(id, callback);\n};\n"]},"metadata":{},"sourceType":"script"}