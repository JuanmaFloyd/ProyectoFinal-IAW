{"ast":null,"code":"'use strict';\n\nmodule.exports = {\n  setup: setupAsync,\n  compile: compileAsync\n};\n\nvar util = require('./compile/util');\n\nvar ASYNC = {\n  '*': checkGenerators,\n  'co*': checkGenerators,\n  'es7': checkAsyncFunction\n};\nvar TRANSPILE = {\n  'nodent': getNodent,\n  'regenerator': getRegenerator\n};\nvar MODES = [{\n  async: 'co*'\n}, {\n  async: 'es7',\n  transpile: 'nodent'\n}, {\n  async: 'co*',\n  transpile: 'regenerator'\n}];\nvar regenerator, nodent;\n\nfunction setupAsync(opts, required) {\n  if (required !== false) required = true;\n  var async = opts.async,\n      transpile = opts.transpile,\n      check;\n\n  switch (typeof transpile) {\n    case 'string':\n      var get = TRANSPILE[transpile];\n      if (!get) throw new Error('bad transpiler: ' + transpile);\n      return opts._transpileFunc = get(opts, required);\n\n    case 'undefined':\n    case 'boolean':\n      if (typeof async == 'string') {\n        check = ASYNC[async];\n        if (!check) throw new Error('bad async mode: ' + async);\n        return opts.transpile = check(opts, required);\n      }\n\n      for (var i = 0; i < MODES.length; i++) {\n        var _opts = MODES[i];\n\n        if (setupAsync(_opts, false)) {\n          util.copy(_opts, opts);\n          return opts.transpile;\n        }\n      }\n      /* istanbul ignore next */\n\n\n      throw new Error('generators, nodent and regenerator are not available');\n\n    case 'function':\n      return opts._transpileFunc = opts.transpile;\n\n    default:\n      throw new Error('bad transpiler: ' + transpile);\n  }\n}\n\nfunction checkGenerators(opts, required) {\n  /* jshint evil: true */\n  try {\n    new Function('(function*(){})()')();\n    return true;\n  } catch (e) {\n    /* istanbul ignore next */\n    if (required) throw new Error('generators not supported');\n  }\n}\n\nfunction checkAsyncFunction(opts, required) {\n  /* jshint evil: true */\n  try {\n    new Function('(async function(){})()')();\n    /* istanbul ignore next */\n\n    return true;\n  } catch (e) {\n    if (required) throw new Error('es7 async functions not supported');\n  }\n}\n\nfunction getRegenerator(opts, required) {\n  try {\n    if (!regenerator) {\n      var name = 'regenerator';\n      regenerator = require(name);\n      regenerator.runtime();\n    }\n\n    if (!opts.async || opts.async === true) opts.async = 'es7';\n    return regeneratorTranspile;\n  } catch (e) {\n    /* istanbul ignore next */\n    if (required) throw new Error('regenerator not available');\n  }\n}\n\nfunction regeneratorTranspile(code) {\n  return regenerator.compile(code).code;\n}\n\nfunction getNodent(opts, required) {\n  /* jshint evil: true */\n  try {\n    if (!nodent) {\n      var name = 'nodent';\n      nodent = require(name)({\n        log: false,\n        dontInstallRequireHook: true\n      });\n    }\n\n    if (opts.async != 'es7') {\n      if (opts.async && opts.async !== true) console.warn('nodent transpiles only es7 async functions');\n      opts.async = 'es7';\n    }\n\n    return nodentTranspile;\n  } catch (e) {\n    /* istanbul ignore next */\n    if (required) throw new Error('nodent not available');\n  }\n}\n\nfunction nodentTranspile(code) {\n  return nodent.compile(code, '', {\n    promises: true,\n    sourcemap: false\n  }).code;\n}\n/**\n * Creates validating function for passed schema with asynchronous loading of missing schemas.\n * `loadSchema` option should be a function that accepts schema uri and node-style callback.\n * @this  Ajv\n * @param {Object}   schema schema object\n * @param {Function} callback node-style callback, it is always called with 2 parameters: error (or null) and validating function.\n */\n\n\nfunction compileAsync(schema, callback) {\n  /* eslint no-shadow: 0 */\n\n  /* jshint validthis: true */\n  var schemaObj;\n  var self = this;\n\n  try {\n    schemaObj = this._addSchema(schema);\n  } catch (e) {\n    setTimeout(function () {\n      callback(e);\n    });\n    return;\n  }\n\n  if (schemaObj.validate) {\n    setTimeout(function () {\n      callback(null, schemaObj.validate);\n    });\n  } else {\n    if (typeof this._opts.loadSchema != 'function') throw new Error('options.loadSchema should be a function');\n\n    _compileAsync(schema, callback, true);\n  }\n\n  function _compileAsync(schema, callback, firstCall) {\n    var validate;\n\n    try {\n      validate = self.compile(schema);\n    } catch (e) {\n      if (e.missingSchema) loadMissingSchema(e);else deferCallback(e);\n      return;\n    }\n\n    deferCallback(null, validate);\n\n    function loadMissingSchema(e) {\n      var ref = e.missingSchema;\n      if (self._refs[ref] || self._schemas[ref]) return callback(new Error('Schema ' + ref + ' is loaded but ' + e.missingRef + ' cannot be resolved'));\n      var _callbacks = self._loadingSchemas[ref];\n\n      if (_callbacks) {\n        if (typeof _callbacks == 'function') self._loadingSchemas[ref] = [_callbacks, schemaLoaded];else _callbacks[_callbacks.length] = schemaLoaded;\n      } else {\n        self._loadingSchemas[ref] = schemaLoaded;\n\n        self._opts.loadSchema(ref, function (err, sch) {\n          var _callbacks = self._loadingSchemas[ref];\n          delete self._loadingSchemas[ref];\n\n          if (typeof _callbacks == 'function') {\n            _callbacks(err, sch);\n          } else {\n            for (var i = 0; i < _callbacks.length; i++) _callbacks[i](err, sch);\n          }\n        });\n      }\n\n      function schemaLoaded(err, sch) {\n        if (err) return callback(err);\n\n        if (!(self._refs[ref] || self._schemas[ref])) {\n          try {\n            self.addSchema(sch, ref);\n          } catch (e) {\n            callback(e);\n            return;\n          }\n        }\n\n        _compileAsync(schema, callback);\n      }\n    }\n\n    function deferCallback(err, validate) {\n      if (firstCall) setTimeout(function () {\n        callback(err, validate);\n      });else return callback(err, validate);\n    }\n  }\n}","map":{"version":3,"sources":["C:/Users/juanm/Documents/Proyecto_web/ProyectoFinal-IAW/cuotasapp/node_modules/mercadopago/node_modules/ajv/lib/async.js"],"names":["module","exports","setup","setupAsync","compile","compileAsync","util","require","ASYNC","checkGenerators","checkAsyncFunction","TRANSPILE","getNodent","getRegenerator","MODES","async","transpile","regenerator","nodent","opts","required","check","get","Error","_transpileFunc","i","length","_opts","copy","Function","e","name","runtime","regeneratorTranspile","code","log","dontInstallRequireHook","console","warn","nodentTranspile","promises","sourcemap","schema","callback","schemaObj","self","_addSchema","setTimeout","validate","loadSchema","_compileAsync","firstCall","missingSchema","loadMissingSchema","deferCallback","ref","_refs","_schemas","missingRef","_callbacks","_loadingSchemas","schemaLoaded","err","sch","addSchema"],"mappings":"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","sourcesContent":["'use strict';\n\nmodule.exports = {\n  setup: setupAsync,\n  compile: compileAsync\n};\n\n\nvar util = require('./compile/util');\n\nvar ASYNC = {\n  '*': checkGenerators,\n  'co*': checkGenerators,\n  'es7': checkAsyncFunction\n};\n\nvar TRANSPILE = {\n  'nodent': getNodent,\n  'regenerator': getRegenerator\n};\n\nvar MODES = [\n  { async: 'co*' },\n  { async: 'es7', transpile: 'nodent' },\n  { async: 'co*', transpile: 'regenerator' }\n];\n\n\nvar regenerator, nodent;\n\n\nfunction setupAsync(opts, required) {\n  if (required !== false) required = true;\n  var async = opts.async\n    , transpile = opts.transpile\n    , check;\n\n  switch (typeof transpile) {\n    case 'string':\n      var get = TRANSPILE[transpile];\n      if (!get) throw new Error('bad transpiler: ' + transpile);\n      return (opts._transpileFunc = get(opts, required));\n    case 'undefined':\n    case 'boolean':\n      if (typeof async == 'string') {\n        check = ASYNC[async];\n        if (!check) throw new Error('bad async mode: ' + async);\n        return (opts.transpile = check(opts, required));\n      }\n\n      for (var i=0; i<MODES.length; i++) {\n        var _opts = MODES[i];\n        if (setupAsync(_opts, false)) {\n          util.copy(_opts, opts);\n          return opts.transpile;\n        }\n      }\n      /* istanbul ignore next */\n      throw new Error('generators, nodent and regenerator are not available');\n    case 'function':\n      return (opts._transpileFunc = opts.transpile);\n    default:\n      throw new Error('bad transpiler: ' + transpile);\n  }\n}\n\n\nfunction checkGenerators(opts, required) {\n  /* jshint evil: true */\n  try {\n    (new Function('(function*(){})()'))();\n    return true;\n  } catch(e) {\n    /* istanbul ignore next */\n    if (required) throw new Error('generators not supported');\n  }\n}\n\n\nfunction checkAsyncFunction(opts, required) {\n  /* jshint evil: true */\n  try {\n    (new Function('(async function(){})()'))();\n    /* istanbul ignore next */\n    return true;\n  } catch(e) {\n    if (required) throw new Error('es7 async functions not supported');\n  }\n}\n\n\nfunction getRegenerator(opts, required) {\n  try {\n    if (!regenerator) {\n      var name = 'regenerator';\n      regenerator = require(name);\n      regenerator.runtime();\n    }\n    if (!opts.async || opts.async === true)\n      opts.async = 'es7';\n    return regeneratorTranspile;\n  } catch(e) {\n    /* istanbul ignore next */\n    if (required) throw new Error('regenerator not available');\n  }\n}\n\n\nfunction regeneratorTranspile(code) {\n  return regenerator.compile(code).code;\n}\n\n\nfunction getNodent(opts, required) {\n  /* jshint evil: true */\n  try {\n    if (!nodent) {\n      var name = 'nodent';\n      nodent = require(name)({ log: false, dontInstallRequireHook: true });\n    }\n    if (opts.async != 'es7') {\n      if (opts.async && opts.async !== true) console.warn('nodent transpiles only es7 async functions');\n      opts.async = 'es7';\n    }\n    return nodentTranspile;\n  } catch(e) {\n    /* istanbul ignore next */\n    if (required) throw new Error('nodent not available');\n  }\n}\n\n\nfunction nodentTranspile(code) {\n  return nodent.compile(code, '', { promises: true, sourcemap: false }).code;\n}\n\n\n/**\n * Creates validating function for passed schema with asynchronous loading of missing schemas.\n * `loadSchema` option should be a function that accepts schema uri and node-style callback.\n * @this  Ajv\n * @param {Object}   schema schema object\n * @param {Function} callback node-style callback, it is always called with 2 parameters: error (or null) and validating function.\n */\nfunction compileAsync(schema, callback) {\n  /* eslint no-shadow: 0 */\n  /* jshint validthis: true */\n  var schemaObj;\n  var self = this;\n  try {\n    schemaObj = this._addSchema(schema);\n  } catch(e) {\n    setTimeout(function() { callback(e); });\n    return;\n  }\n  if (schemaObj.validate) {\n    setTimeout(function() { callback(null, schemaObj.validate); });\n  } else {\n    if (typeof this._opts.loadSchema != 'function')\n      throw new Error('options.loadSchema should be a function');\n    _compileAsync(schema, callback, true);\n  }\n\n\n  function _compileAsync(schema, callback, firstCall) {\n    var validate;\n    try { validate = self.compile(schema); }\n    catch(e) {\n      if (e.missingSchema) loadMissingSchema(e);\n      else deferCallback(e);\n      return;\n    }\n    deferCallback(null, validate);\n\n    function loadMissingSchema(e) {\n      var ref = e.missingSchema;\n      if (self._refs[ref] || self._schemas[ref])\n        return callback(new Error('Schema ' + ref + ' is loaded but ' + e.missingRef + ' cannot be resolved'));\n      var _callbacks = self._loadingSchemas[ref];\n      if (_callbacks) {\n        if (typeof _callbacks == 'function')\n          self._loadingSchemas[ref] = [_callbacks, schemaLoaded];\n        else\n          _callbacks[_callbacks.length] = schemaLoaded;\n      } else {\n        self._loadingSchemas[ref] = schemaLoaded;\n        self._opts.loadSchema(ref, function (err, sch) {\n          var _callbacks = self._loadingSchemas[ref];\n          delete self._loadingSchemas[ref];\n          if (typeof _callbacks == 'function') {\n            _callbacks(err, sch);\n          } else {\n            for (var i=0; i<_callbacks.length; i++)\n              _callbacks[i](err, sch);\n          }\n        });\n      }\n\n      function schemaLoaded(err, sch) {\n        if (err) return callback(err);\n        if (!(self._refs[ref] || self._schemas[ref])) {\n          try {\n            self.addSchema(sch, ref);\n          } catch(e) {\n            callback(e);\n            return;\n          }\n        }\n        _compileAsync(schema, callback);\n      }\n    }\n\n    function deferCallback(err, validate) {\n      if (firstCall) setTimeout(function() { callback(err, validate); });\n      else return callback(err, validate);\n    }\n  }\n}\n"]},"metadata":{},"sourceType":"script"}